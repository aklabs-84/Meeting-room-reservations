<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- 파비콘 -->
    <!-- 파비콘 (PNG 버전) -->
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32.png">

    <!-- Open Graph 메타태그 (URL 공유용 썸네일) -->
    <meta property="og:title" content="회의실 예약 시스템">
    <meta property="og:description" content="간편하고 효율적인 회의실 관리 서비스">
    <meta property="og:image" content="https://drive.google.com/uc?export=view&id=1kIIefb4rl9VFzAQR74ZHoQztbu9AIkyv">
    <meta property="og:url" content="https://aklabs-84.github.io/Meeting-room-reservations/">
    <meta property="og:type" content="website">
    <title>회의실 예약 시스템</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .calendar-day {
            min-height: 80px;
        }
        .booking-indicator {
            font-size: 10px;
            padding: 2px 4px;
            margin: 1px;
            border-radius: 3px;
        }
        .modal {
            backdrop-filter: blur(4px);
        }
        .loading {
            opacity: 0.7;
            pointer-events: none;
        }
        .glass-effect {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 via-white to-indigo-50 min-h-screen">
    <!-- 메인 컨테이너 -->
    <div class="container mx-auto px-6 py-8">
        <div class="text-center mb-12">
            <h1 class="text-4xl font-bold bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent mb-3">
                회의실 예약 시스템
            </h1>
            <p class="text-gray-600 text-lg">간편하고 효율적인 회의실 관리</p>
        </div>
        
        <div class="grid grid-cols-1 lg:grid-cols-5 gap-8">
            <!-- 왼쪽: 예약 입력 폼 -->
            <div class="lg:col-span-2">
                <div class="glass-effect rounded-2xl shadow-xl border border-white/20 p-8">
                    <div class="flex items-center gap-3 mb-8">
                        <div class="w-10 h-10 bg-gradient-to-r from-blue-500 to-indigo-500 rounded-xl flex items-center justify-center">
                            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                            </svg>
                        </div>
                        <h2 class="text-2xl font-semibold text-gray-800">새 예약</h2>
                    </div>
                    
                    <form id="bookingForm" class="space-y-6">
                        <!-- 예약자 이름 -->
                        <div class="space-y-2">
                            <label class="block text-sm font-medium text-gray-700">예약자 이름</label>
                            <input type="text" id="bookerName" required 
                                   class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200 bg-white/70">
                        </div>

                        <!-- 회의실 선택 -->
                        <div class="space-y-2">
                            <label class="block text-sm font-medium text-gray-700">회의실</label>
                            <select id="roomNumber" required 
                                    class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200 bg-white/70">
                                <option value="">회의실을 선택하세요</option>
                                <option value="510">510호</option>
                                <option value="512">512호</option>
                                <option value="513">513호</option>
                            </select>
                        </div>

                        <!-- 예약 목적 -->
                        <div class="space-y-2">
                            <label class="block text-sm font-medium text-gray-700">예약 목적</label>
                            <textarea id="purpose" required rows="3"
                                      class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200 bg-white/70 resize-none"
                                      placeholder="회의 목적을 입력하세요"></textarea>
                        </div>

                        <!-- 예약 날짜 -->
                        <div class="space-y-2">
                            <label class="block text-sm font-medium text-gray-700">예약 날짜</label>
                            <input type="date" id="bookingDate" required 
                                   class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200 bg-white/70">
                        </div>

                        <!-- 시간 선택 -->
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <!-- 시작 시간 -->
                            <div class="space-y-2">
                                <label class="block text-sm font-medium text-gray-700">시작 시간</label>
                                <select id="startTime" required 
                                        class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200 bg-white/70">
                                    <option value="">시작 시간 선택</option>
                                </select>
                            </div>

                            <!-- 종료 시간 -->
                            <div class="space-y-2">
                                <label class="block text-sm font-medium text-gray-700">종료 시간</label>
                                <select id="endTime" required 
                                        class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200 bg-white/70">
                                    <option value="">종료 시간 선택</option>
                                </select>
                            </div>
                        </div>

                        <!-- 예약 버튼 -->
                        <button type="submit" id="bookingBtn"
                                class="w-full bg-gradient-to-r from-blue-500 to-indigo-600 text-white py-4 px-6 rounded-xl hover:from-blue-600 hover:to-indigo-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition duration-200 transform hover:scale-[1.02] font-semibold text-lg shadow-lg">
                            예약하기
                        </button>
                    </form>

                    <!-- 메시지 표시 영역 -->
                    <div id="messageArea" class="mt-6"></div>
                </div>
            </div>

            <!-- 오른쪽: 캘린더 -->
            <div class="lg:col-span-3">
                <div class="glass-effect rounded-2xl shadow-xl border border-white/20 p-8">
                    <div class="flex items-center gap-3 mb-8">
                        <div class="w-10 h-10 bg-gradient-to-r from-indigo-500 to-purple-500 rounded-xl flex items-center justify-center">
                            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                            </svg>
                        </div>
                        <h2 class="text-2xl font-semibold text-gray-800">예약 현황</h2>
                    </div>
                    
                    <!-- 로딩 상태 표시 -->
                    <div id="loadingIndicator" class="text-center py-8 hidden">
                        <div class="inline-flex items-center px-6 py-3 bg-blue-50 rounded-xl">
                            <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                            <span class="text-blue-600 font-medium">예약 현황을 불러오는 중...</span>
                        </div>
                    </div>
                    
                    <!-- 캘린더 네비게이션 -->
                    <div class="flex justify-between items-center mb-8">
                        <button id="prevMonth" class="px-4 py-2 bg-white/60 hover:bg-white/80 border border-gray-200 rounded-xl transition duration-200 shadow-sm">
                            <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                            </svg>
                        </button>
                        <h3 id="currentMonth" class="text-xl font-semibold text-gray-800"></h3>
                        <button id="nextMonth" class="px-4 py-2 bg-white/60 hover:bg-white/80 border border-gray-200 rounded-xl transition duration-200 shadow-sm">
                            <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                            </svg>
                        </button>
                    </div>

                    <!-- 캘린더 요일 헤더 -->
                    <div class="grid grid-cols-7 gap-2 mb-4">
                        <div class="text-center font-semibold text-red-500 py-3 text-sm">일</div>
                        <div class="text-center font-semibold text-gray-600 py-3 text-sm">월</div>
                        <div class="text-center font-semibold text-gray-600 py-3 text-sm">화</div>
                        <div class="text-center font-semibold text-gray-600 py-3 text-sm">수</div>
                        <div class="text-center font-semibold text-gray-600 py-3 text-sm">목</div>
                        <div class="text-center font-semibold text-gray-600 py-3 text-sm">금</div>
                        <div class="text-center font-semibold text-blue-500 py-3 text-sm">토</div>
                    </div>

                    <!-- 캘린더 그리드 -->
                    <div id="calendarGrid" class="grid grid-cols-7 gap-2">
                        <!-- 캘린더 날짜들이 여기에 동적으로 생성됩니다 -->
                    </div>

                    <!-- 디버그 정보 -->
                    <div id="debugInfo" class="mt-6 text-xs text-gray-500 hidden bg-gray-50 rounded-lg p-3">
                        <!-- 디버깅용 정보 표시 -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 예약 상세 모달 -->
    <div id="bookingModal" class="fixed inset-0 bg-black/40 modal hidden items-center justify-center z-50 p-4">
        <div class="glass-effect rounded-2xl p-8 max-w-md w-full mx-4 shadow-2xl border border-white/20">
            <div class="flex items-center gap-3 mb-6">
                <div class="w-8 h-8 bg-gradient-to-r from-blue-500 to-indigo-500 rounded-lg flex items-center justify-center">
                    <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                </div>
                <h3 class="text-xl font-semibold text-gray-800">예약 상세 정보</h3>
            </div>
            <div id="modalContent" class="space-y-4 mb-6">
                <!-- 상세 정보가 여기에 표시됩니다 -->
            </div>
            <button id="closeModal" class="w-full bg-gradient-to-r from-gray-500 to-gray-600 text-white py-3 rounded-xl hover:from-gray-600 hover:to-gray-700 transition duration-200 font-medium">
                닫기
            </button>
        </div>
    </div>

    <script>
        // 구글 앱스 스크립트 웹앱 URL (여기에 실제 URL을 입력하세요)
        const GOOGLE_APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbx07GaunGFSsIkoC7Rbem7_fVTAwB3pN9MAALRrUa4q6xZNbW5E_N5FjH6c-4b3Z6NS/exec';

        // 전역 변수
        let currentDate = new Date();
        let allBookings = [];
        let isLoading = false;

        // 페이지 로드 시 초기화
        document.addEventListener('DOMContentLoaded', function() {
            console.log('페이지 로드 완료');
            
            initializeTimeOptions();
            setupEventListeners();
            renderCalendar(); // 빈 캘린더 먼저 렌더링
            
            // 오늘 날짜를 기본값으로 설정
            const today = new Date();
            document.getElementById('bookingDate').valueAsDate = today;
            
            // 예약 목록 로드
            loadBookings();
        });

        // 12:00 ~ 18:00 (30분 단위)
        // 00:00 ~ 24:00 (30분 단위) 전체 옵션 생성
        function initializeTimeOptions() {
        const startTimeSelect = document.getElementById('startTime');
        const endTimeSelect = document.getElementById('endTime');

        const makeAllTimes = (selectEl) => {
            selectEl.innerHTML = '<option value="">시간 선택</option>';
            for (let hour = 0; hour <= 24; hour++) {
            for (let minute = 0; minute < 60; minute += 30) {
                if (hour === 24 && minute > 0) break; // 24:00만 허용
                const timeString = `${String(hour).padStart(2,'0')}:${String(minute).padStart(2,'0')}`;
                selectEl.appendChild(new Option(timeString, timeString));
            }
            }
        };

        makeAllTimes(startTimeSelect); // 시작: 전체
        makeAllTimes(endTimeSelect);   // 종료: (초기엔) 전체
        }



        // 이벤트 리스너 설정
        function setupEventListeners() {
            // 폼 제출
            document.getElementById('bookingForm').addEventListener('submit', handleBookingSubmit);
            
            // 시작 시간 변경 시 종료 시간 제한
            document.getElementById('startTime').addEventListener('change', updateEndTimeOptions);
            
            // 캘린더 네비게이션
            document.getElementById('prevMonth').addEventListener('click', () => {
                currentDate.setMonth(currentDate.getMonth() - 1);
                renderCalendar();
            });
            
            document.getElementById('nextMonth').addEventListener('click', () => {
                currentDate.setMonth(currentDate.getMonth() + 1);
                renderCalendar();
            });
            
            // 모달 닫기
            document.getElementById('closeModal').addEventListener('click', closeModal);
            document.getElementById('bookingModal').addEventListener('click', (e) => {
                if (e.target === document.getElementById('bookingModal')) {
                    closeModal();
                }
            });
        }

        // 종료 시간 옵션 업데이트 (3시간 제한)
        function updateEndTimeOptions() {
        const startTime = document.getElementById('startTime').value;
        const endTimeSelect = document.getElementById('endTime');

        const toMin = (t) => {
            const [h, m] = t.split(':').map(Number);
            return h * 60 + m;
        };
        const toStr = (m) =>
            `${String(Math.floor(m/60)).padStart(2,'0')}:${String(m%60).padStart(2,'0')}`;

        // 시작시간이 없으면 종료시간은 다시 전체(00:00~24:00) 노출
        if (!startTime) {
            initializeTimeOptions(); // 양쪽 다 초기화해도 무방
            return;
        }

        endTimeSelect.innerHTML = '<option value="">종료 시간 선택</option>';

        const startM = toMin(startTime);
        const maxEndM = Math.min(startM + 180, 24 * 60); // +3시간, 최대 24:00

        let hasOption = false;
        for (let m = startM + 30; m <= maxEndM; m += 30) {
            endTimeSelect.appendChild(new Option(toStr(m), toStr(m)));
            hasOption = true;
        }

        if (!hasOption) {
            const opt = new Option('선택 가능한 종료 시간이 없습니다 (당일 24:00 초과)', '');
            opt.disabled = true;
            endTimeSelect.appendChild(opt);
        }
        }



        // 예약 제출 처리 (수정된 버전)
        async function handleBookingSubmit(e) {
            e.preventDefault();
            
            if (isLoading) return;

            const formData = {
                bookerName: document.getElementById('bookerName').value.trim(),
                roomNumber: document.getElementById('roomNumber').value,
                purpose: document.getElementById('purpose').value.trim(),
                bookingDate: document.getElementById('bookingDate').value,
                startTime: document.getElementById('startTime').value,
                endTime: document.getElementById('endTime').value
            };

            // 클라이언트 측 유효성 검사 (서버 검사와 별도로)
            if (!validateBookingClient(formData)) return;

            try {
                // 로딩 상태
                setLoading(true);
                const bookingBtn = document.getElementById('bookingBtn');
                bookingBtn.disabled = true;
                bookingBtn.textContent = '예약 중...';

                console.log('예약 요청 데이터:', formData);

                // 서버에 예약 요청 (no-cors 제거)
                const response = await fetch(GOOGLE_APPS_SCRIPT_URL, {
                    method: 'POST',
                    // ★ 프리플라이트(OPTIONS) 발생 방지: application/json 대신 text/plain 사용
                    headers: { 'Content-Type': 'text/plain;charset=utf-8' },
                    body: JSON.stringify({
                        action: 'addBooking',
                        ...formData,
                        timestamp: new Date().toLocaleString('ko-KR')
                    })
                });

                // JSON 파싱
                let result;
                try {
                result = await response.json();
                } catch (parseError) {
                console.error('응답 파싱 오류:', parseError);
                throw new Error('서버 응답을 읽을 수 없습니다.');
                }

                if (result.status === 'success') {
                    // 성공 메시지 표시
                    showMessage(result.message, 'success');
                    
                    // 폼 초기화
                    document.getElementById('bookingForm').reset();
                    document.getElementById('endTime').innerHTML = '<option value="">종료 시간 선택</option>';
                    
                    // 예약 목록 새로고침
                    await loadBookings();
                    renderCalendar();
                } else {
                    // 서버에서 반환한 오류 메시지 표시
                    showMessage(result.message || '예약 중 오류가 발생했습니다.', 'error');
                }

            } catch (error) {
                console.error('예약 중 오류 발생:', error);
                showMessage('예약 중 오류가 발생했습니다: ' + error.message, 'error');
            } finally {
                setLoading(false);
                const bookingBtn = document.getElementById('bookingBtn');
                bookingBtn.disabled = false;
                bookingBtn.textContent = '예약하기';
            }
        }

        // 클라이언트 측 예약 유효성 검사
        function validateBookingClient(formData) {
        // 1) 공란 검사
        for (const [key, value] of Object.entries(formData)) {
            if (!value) {
            showMessage(`${getFieldName(key)}을(를) 입력해주세요.`, 'error');
            return false;
            }
        }

        // 2) 과거 날짜 금지 (로컬 기준 비교: YYYY-MM-DD → Date(y, m-1, d))
        const [y, m, d] = formData.bookingDate.split('-').map(Number);
        const bookingDateLocal = new Date(y, m - 1, d); // 로컬 자정
        const todayLocal = new Date();
        todayLocal.setHours(0, 0, 0, 0);
        if (bookingDateLocal < todayLocal) {
            showMessage('과거 날짜는 예약할 수 없습니다.', 'error');
            return false;
        }

        // 3) 시간 순서 검사
        if (formData.startTime >= formData.endTime) {
            showMessage('종료 시간은 시작 시간보다 늦어야 합니다.', 'error');
            return false;
        }

        // 4) 종료 시간은 시작 시간 기준 최대 3시간(프런트 제한·서버도 검증)
        const toMin = (t) => {
            const [hh, mm] = t.split(':').map(Number);
            return hh * 60 + mm;
        };
        const startM = toMin(formData.startTime);
        const endM = toMin(formData.endTime);
        if (endM - startM > 180) {
            showMessage('한 번에 최대 3시간까지만 예약할 수 있습니다.', 'error');
            return false;
        }

        // 5) 당일 24:00 초과 금지 (이론상 드롭다운이 막지만 안전망)
        if (endM > 24 * 60) {
            showMessage('종료 시간은 24:00을 초과할 수 없습니다.', 'error');
            return false;
        }

        // (알림) 서버 정책: 12:00 이전은 거절될 수 있음 — UI 정책과 다르면 안내 메시지 표시 고려
        return true;
        }



        // 필드명 한국어 변환
        function getFieldName(field) {
            const names = {
                bookerName: '예약자 이름',
                roomNumber: '회의실',
                purpose: '예약 목적',
                bookingDate: '예약 날짜',
                startTime: '시작 시간',
                endTime: '종료 시간'
            };
            return names[field] || field;
        }

        // 로딩 상태 설정
        function setLoading(loading) {
            isLoading = loading;
            const loadingIndicator = document.getElementById('loadingIndicator');
            const calendarContainer = document.querySelector('.lg\\:col-span-3 .glass-effect');
            
            if (loading) {
                loadingIndicator.classList.remove('hidden');
                if (calendarContainer) calendarContainer.classList.add('loading');
            } else {
                loadingIndicator.classList.add('hidden');
                if (calendarContainer) calendarContainer.classList.remove('loading');
            }
        }

        // 시간 겹침 확인 (클라이언트용)
        function isTimeConflict(start1, end1, start2, end2) {
            const toMinutes = (time) => {
                const [hour, minute] = time.split(':').map(Number);
                return hour * 60 + minute;
            };

            const s1 = toMinutes(start1);
            const e1 = toMinutes(end1);
            const s2 = toMinutes(start2);
            const e2 = toMinutes(end2);

            return s1 < e2 && e1 > s2;
        }

        // 기존 예약 목록 로드 (수정된 버전)
        async function loadBookings() {
            try {
                setLoading(true);
                console.log('예약 목록 로드 시작...');
                
                const response = await fetch(GOOGLE_APPS_SCRIPT_URL + '?action=getBookings');
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                console.log('로드된 예약 데이터:', data);
                
                if (data.status === 'success') {
                    allBookings = data.bookings || [];
                    console.log('예약 목록 로드 완료:', allBookings.length, '개의 예약');
                    
                    // 디버그 정보 표시
                    const debugInfo = document.getElementById('debugInfo');
                    debugInfo.textContent = `로드된 예약: ${allBookings.length}개`;
                    debugInfo.classList.remove('hidden');
                    
                    // 예약 데이터 로드 후 캘린더 다시 렌더링
                    renderCalendar();
                } else {
                    console.error('예약 목록 로드 실패:', data.message);
                    allBookings = [];
                }
            } catch (error) {
                console.error('예약 목록 로드 오류:', error);
                allBookings = [];
                showMessage('예약 현황을 불러올 수 없습니다: ' + error.message, 'error');
            } finally {
                setLoading(false);
            }
        }

        // 캘린더 렌더링 (수정된 버전)
        function renderCalendar() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            
            console.log(`캘린더 렌더링: ${year}년 ${month + 1}월, 예약 데이터: ${allBookings.length}개`);
            
            // 월 표시 업데이트
            document.getElementById('currentMonth').textContent = 
                `${year}년 ${month + 1}월`;

            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const startDate = new Date(firstDay);
            startDate.setDate(startDate.getDate() - firstDay.getDay());

            const calendarGrid = document.getElementById('calendarGrid');
            calendarGrid.innerHTML = '';

            // 6주 표시
            for (let week = 0; week < 6; week++) {
                for (let day = 0; day < 7; day++) {
                    const date = new Date(startDate);
                    date.setDate(startDate.getDate() + week * 7 + day);

                    const dayElement = createCalendarDay(date, month);
                    calendarGrid.appendChild(dayElement);
                }
            }
        }

        // 캘린더 날짜 셀 생성 (수정된 버전)
        function createCalendarDay(date, currentMonth) {
            const dayDiv = document.createElement('div');
            const isCurrentMonth = date.getMonth() === currentMonth;
            const isToday = date.toDateString() === new Date().toDateString();
            const isWeekend = date.getDay() === 0 || date.getDay() === 6;
            
            dayDiv.className = `calendar-day border border-gray-100 p-3 rounded-xl transition duration-200 hover:shadow-md cursor-pointer ${
                isCurrentMonth 
                    ? isToday 
                        ? 'bg-gradient-to-br from-blue-50 to-indigo-50 border-blue-200 ring-2 ring-blue-200' 
                        : 'bg-white/70 hover:bg-white/90' 
                    : 'bg-gray-50/50 text-gray-400'
            }`;

            const dateString = formatYMDLocal(date);  
            
            // 날짜 숫자
            const dateNumber = document.createElement('div');
            dateNumber.className = `text-sm font-semibold mb-2 ${
                isToday 
                    ? 'text-blue-600' 
                    : isCurrentMonth 
                        ? isWeekend 
                            ? date.getDay() === 0 ? 'text-red-500' : 'text-blue-500'
                            : 'text-gray-700'
                        : 'text-gray-400'
            }`;
            dateNumber.textContent = date.getDate();
            dayDiv.appendChild(dateNumber);

            // 해당 날짜의 예약 표시
            const dayBookings = allBookings.filter(booking => {
                const bookingDate = booking.예약날짜;
                console.log(`날짜 비교: ${bookingDate} vs ${dateString}`);
                return bookingDate === dateString;
            });

            function formatYMDLocal(d) {
                const y = d.getFullYear();
                const m = String(d.getMonth() + 1).padStart(2, '0');
                const day = String(d.getDate()).padStart(2, '0');
                return `${y}-${m}-${day}`;
            }

            
            console.log(`${dateString} 날짜의 예약:`, dayBookings);

            dayBookings.forEach((booking, index) => {
                if (index < 3) { // 최대 3개까지만 표시
                    const bookingDiv = document.createElement('div');
                    bookingDiv.className = 'booking-indicator bg-gradient-to-r from-blue-100 to-indigo-100 text-blue-700 rounded-lg border border-blue-200 truncate font-medium';
                    bookingDiv.textContent = `${booking.회의실}호 ${booking.예약자}`;
                    bookingDiv.title = `${booking.예약자} - ${booking.회의실}호 (${booking.시작시간}-${booking.종료시간})`;
                    dayDiv.appendChild(bookingDiv);
                } else if (index === 3) {
                    // 3개 초과 시 '더보기' 표시
                    const moreDiv = document.createElement('div');
                    moreDiv.className = 'booking-indicator bg-gradient-to-r from-gray-100 to-gray-200 text-gray-600 rounded-lg border border-gray-200 font-medium';
                    moreDiv.textContent = `+${dayBookings.length - 3}개 더`;
                    dayDiv.appendChild(moreDiv);
                }
            });

            // 클릭 이벤트
            dayDiv.addEventListener('click', () => {
                if (dayBookings.length > 0) {
                    showBookingDetails(dateString, dayBookings);
                }
            });

            return dayDiv;
        }

        // 예약 상세 정보 모달 표시 (수정된 버전)
        function showBookingDetails(date, bookings) {
            const modalContent = document.getElementById('modalContent');
            modalContent.innerHTML = '';

            const dateTitle = document.createElement('h4');
            dateTitle.className = 'font-semibold text-gray-800 mb-4 text-lg';
            dateTitle.textContent = `${formatDateKorean(date)} 예약 현황`;
            modalContent.appendChild(dateTitle);

            bookings.forEach(booking => {
                const bookingDiv = document.createElement('div');
                bookingDiv.className = 'border border-gray-200 rounded-xl p-4 mb-3 bg-gradient-to-r from-blue-50 to-indigo-50';
                bookingDiv.innerHTML = `
                    <div class="flex items-center gap-2 mb-2">
                        <div class="w-6 h-6 bg-gradient-to-r from-blue-500 to-indigo-500 rounded-lg flex items-center justify-center text-white font-bold text-sm">
                            ${booking.회의실}
                        </div>
                        <div class="font-semibold text-gray-800">${booking.회의실}호</div>
                    </div>
                    <div class="text-sm text-gray-600 space-y-1 ml-8">
                        <div class="flex items-center gap-2">
                            <svg class="w-4 h-4 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                            </svg>
                            <span>예약자: ${booking.예약자}</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <svg class="w-4 h-4 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                            <span>시간: ${booking.시작시간} ~ ${booking.종료시간}</span>
                        </div>
                        <div class="flex items-start gap-2">
                            <svg class="w-4 h-4 text-gray-500 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                            </svg>
                            <span>목적: ${booking.예약목적}</span>
                        </div>
                    </div>
                `;
                modalContent.appendChild(bookingDiv);
            });

            document.getElementById('bookingModal').classList.remove('hidden');
            document.getElementById('bookingModal').classList.add('flex');
        }

        // 날짜를 한국어 형식으로 변환
        function formatDateKorean(dateString) {
            const [y, m, d] = dateString.split('-').map(Number);
            return `${y}년 ${m}월 ${d}일`;
        }



        // 모달 닫기
        function closeModal() {
            document.getElementById('bookingModal').classList.add('hidden');
            document.getElementById('bookingModal').classList.remove('flex');
        }

        // 메시지 표시 (개선된 버전)
        function showMessage(message, type) {
            const messageArea = document.getElementById('messageArea');
            const messageDiv = document.createElement('div');
            
            messageDiv.className = `p-4 rounded-xl border transition duration-200 ${
                type === 'success' 
                ? 'bg-gradient-to-r from-green-50 to-emerald-50 text-green-800 border-green-200' 
                : 'bg-gradient-to-r from-red-50 to-rose-50 text-red-800 border-red-200'
            }`;
            
            const iconSvg = type === 'success' 
                ? '<svg class="w-5 h-5 text-green-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>'
                : '<svg class="w-5 h-5 text-red-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>';
            
            messageDiv.innerHTML = `
                <div class="flex items-center">
                    ${iconSvg}
                    <span class="font-medium">${message}</span>
                </div>
            `;
            
            messageArea.innerHTML = '';
            messageArea.appendChild(messageDiv);
            
            // 5초 후 메시지 제거
            setTimeout(() => {
                if (messageDiv.parentNode) {
                    messageDiv.remove();
                }
            }, 5000);
        }

        // 페이지가 완전히 로드된 후 추가 초기화
        window.addEventListener('load', function() {
            console.log('Window load 이벤트 완료');
            // 필요시 추가 초기화 코드
        });
    </script>
</body>
</html>
